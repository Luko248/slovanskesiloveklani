---
phase: 01-foundation-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/Header.astro
autonomous: true

must_haves:
  truths:
    - "Mobile menu opens when hamburger button is clicked"
    - "Mobile menu closes when X button is clicked"
    - "Mobile menu closes when navigation link is clicked"
    - "Site builds without errors (no missing ThemeToggle import)"
  artifacts:
    - path: "src/components/Header.astro"
      provides: "Header with working mobile menu"
      contains: "mobile-menu-toggle"
  key_links:
    - from: "Header.astro script"
      to: "mobile-menu-toggle button"
      via: "getElementById"
      pattern: "getElementById\\('mobile-menu-toggle'\\)"
    - from: "Header.astro script"
      to: "mobile-menu element"
      via: "classList.toggle translate-x-full"
      pattern: "classList\\.toggle\\('translate-x-full'\\)"
---

<objective>
Fix mobile menu functionality and remove broken ThemeToggle import

Purpose: Make mobile navigation work correctly on all devices. The menu is currently completely broken due to ID mismatches in JavaScript and importing a deleted component.

Output: Working mobile menu that opens, closes, and allows navigation on mobile devices
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-fixes/01-RESEARCH.md
@src/components/Header.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove ThemeToggle import and fix dark: variants in Header</name>
  <files>src/components/Header.astro</files>
  <action>
In Header.astro frontmatter (lines 1-16):

1. Remove line 2: `import ThemeToggle from './ThemeToggle.astro';`
   - This file was deleted, causing build failures

In Header.astro template:

2. Simplify dark: variant classes (site is dark-mode only):
   - Line 36: Change `text-viking-red dark:text-blood-red` to `text-viking-red`
   - Line 72: Change `text-charcoal dark:text-light-cream` to `text-light-cream`
   - Line 98: Change `border-black/5 dark:border-white/5` to `border-white/5`
   - Line 98: Change `hover:text-viking-red dark:hover:text-blood-red` to `hover:text-viking-red`

Why: Dark mode is enforced globally via body styles. The dark: variants are redundant and confusing. Line 72 is particularly problematic - it shows charcoal text on charcoal background in non-dark mode which doesn't exist.
  </action>
  <verify>
- No import of ThemeToggle in Header.astro
- No `dark:` prefix in Header.astro CSS classes
- `bun run build` succeeds (no missing import error)
  </verify>
  <done>
ThemeToggle import removed, dark: variants simplified to base classes
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix mobile menu JavaScript selectors and animation</name>
  <files>src/components/Header.astro</files>
  <action>
Fix the script section (lines 108-130) in Header.astro:

1. Fix button ID selector - change line 111:
   From: `const btn = document.getElementById('mobile-menu-toggle');`
   To: `const btn = document.getElementById('mobile-menu-btn');`

   Reason: Button element on line 71 has id="mobile-menu-btn"

2. Add close button handler - the close button (id="close-menu-btn" on line 89) has no handler:
   Add: `const closeBtn = document.getElementById('close-menu-btn');`
   Add: `closeBtn?.addEventListener('click', () => { menu?.classList.add('translate-x-full'); });`

3. Fix toggle animation - change line 118:
   From: `menu?.classList.toggle('hidden');`
   To: `menu?.classList.toggle('translate-x-full');`

   Reason: Menu uses translate-x-full for slide animation (line 86), not hidden class

4. Fix close on link click - change line 124:
   From: `menu?.classList.add('hidden');`
   To: `menu?.classList.add('translate-x-full');`

5. Fix calendar button ID selector - change line 113:
   From: `const calendarBtn = document.getElementById('add-to-calendar');`
   To: `const calendarBtn = document.getElementById('add-to-calendar-btn');`

   Reason: Button element on line 58 has id="add-to-calendar-btn"

Complete fixed script section should look like:
```javascript
import { downloadICS } from '../utils/calendar';

const btn = document.getElementById('mobile-menu-btn');
const closeBtn = document.getElementById('close-menu-btn');
const menu = document.getElementById('mobile-menu');
const calendarBtn = document.getElementById('add-to-calendar-btn');
const mobileCalendarBtn = document.getElementById('mobile-calendar-btn');
const mobileLinks = document.querySelectorAll('.mobile-link');

btn?.addEventListener('click', () => {
  menu?.classList.toggle('translate-x-full');
});

closeBtn?.addEventListener('click', () => {
  menu?.classList.add('translate-x-full');
});

mobileLinks.forEach(link => {
  link.addEventListener('click', () => {
    menu?.classList.add('translate-x-full');
  });
});

calendarBtn?.addEventListener('click', downloadICS);
mobileCalendarBtn?.addEventListener('click', downloadICS);
```
  </action>
  <verify>
- `bun run dev` and test on mobile viewport:
  1. Click hamburger menu icon - menu should slide in from right
  2. Click X button - menu should slide out to right
  3. Click any nav link - menu should close and page should scroll to section
  4. Click "Přidat do kalendáře" button - should download .ics file
- Desktop calendar button "Do Kalendáře" should also download .ics file
  </verify>
  <done>
Mobile menu opens, closes via X button, closes on nav link click, calendar buttons work
  </done>
</task>

</tasks>

<verification>
- [ ] `bun run build` succeeds (no ThemeToggle import error)
- [ ] No `dark:` classes in Header.astro
- [ ] Mobile menu opens when clicking hamburger button
- [ ] Mobile menu closes when clicking X button
- [ ] Mobile menu closes when clicking a navigation link
- [ ] Desktop calendar button downloads .ics file
- [ ] Mobile calendar button downloads .ics file
</verification>

<success_criteria>
- Site builds without errors
- Mobile navigation is fully functional
- All calendar download buttons work
- No redundant dark: variants in Header
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-fixes/01-02-SUMMARY.md`
</output>
