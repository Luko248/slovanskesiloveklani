---
const slides = [
  {
    title: "Historický slovanský boj",
    description:
      "Hlavní bod doprovodného programu — ukázka historického slovanského boje. Uvidíte souboje s meči a štíty, sekerami i halapartnami v podání zkušených šermířů. Prožijte atmosféru dávných bitev na vlastní oči.",
    image: "/images/program/duel.avif",
  },
  {
    title: "Tradiční kovářská dílna",
    description:
      "Na místě bude přítomen tradiční kovář s ukázkou řemesla našich předků. Sledujte, jak pod údery kladiva vznikají jedinečné výrobky. Zakupte si originální kovaný suvenýr přímo z výhně — nože, přívěsky nebo ozdoby.",
    image: "/images/program/blcksmith.avif",
  },
  {
    title: "Lukostřelba",
    description:
      "Vyzkoušejte si střelbu z luku pod dohledem zkušených instruktorů. Ať už jste začátečník nebo ostřílený lučištník, na místě si můžete otestovat svůj postřeh a přesnost. Zábava pro děti i dospělé.",
    image: "/images/program/bow-shooting.avif",
  },
  {
    title: "Občerstvení & Grill",
    description:
      "Naši dobrovolní hasiči pro vás připraví grilované speciality — klobásy, steaky a další pochoutky přímo na ohni. K dispozici bude také bar s točeným pivem, medovinou a nealkoholickými nápoji. Nikdo neodejde hladový.",
    image: "/images/program/refreshment.avif",
  },
];
const total = slides.length.toString().padStart(2, "0");
---

<section
  id="attractions"
  class="py-16 md:py-32 bg-deep-charcoal relative scroll-mt-24"
>
  <div class="container mx-auto px-4 relative z-10">
    <!-- Section Header -->
    <div class="text-center mb-16 max-w-3xl mx-auto">
      <div class="inline-flex items-center gap-4 mb-6">
        <span class="h-1 w-12 bg-viking-green"></span>
        <h2
          class="text-4xl md:text-5xl font-display font-bold text-light-cream"
        >
          Doprovodný Program
        </h2>
        <span class="h-1 w-12 bg-viking-green"></span>
      </div>
      <p class="text-xl text-gray-400">
        Slovanské Silové Klání není jen soutěž — je to celý den plný zážitků,
        řemesel a chutí.
      </p>
    </div>

    <!-- CSS-only Carousel — scroll-snap + ::scroll-marker -->
    <div class="carousel max-w-4xl mx-auto">
      {
        slides.map((slide, idx) => (
          <div class="carousel__slide">
            <div class="carousel-layout">
              {/* Text side */}
              <div class="carousel-text">
                <div class="inline-flex items-center gap-3">
                  <span class="h-1 w-8 bg-viking-gold" />
                  <span class="text-viking-gold font-display text-sm uppercase tracking-widest">
                    {`0${idx + 1} / ${total}`}
                  </span>
                </div>
                <h3 class="text-3xl md:text-4xl font-display font-bold text-light-cream">
                  {slide.title}
                </h3>
                <p class="text-lg leading-relaxed text-gray-400">
                  {slide.description}
                </p>
              </div>

              {/* Image side */}
              <div class="carousel-image">
                <div class={`relative category-card overflow-hidden aspect-[4/3] border-8 border-double ${idx % 2 === 0 ? 'border-viking-green/40' : 'border-viking-gold/40'}`}>
                  <img
                    src={slide.image}
                    alt={slide.title}
                    class="w-full h-full object-cover"
                    loading="lazy"
                  />
                  <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent pointer-events-none" />
                </div>
              </div>
            </div>
          </div>
        ))
      }
    </div>

    {/* Fallback markers — rendered in HTML, hidden only when native markers are confirmed */}
    <div class="carousel-markers max-w-4xl mx-auto" role="tablist" aria-label="Carousel navigation">
      {
        slides.map((slide, idx) => (
          <button
            type="button"
            role="tab"
            aria-label={`Slide ${idx + 1}: ${slide.title}`}
            aria-selected={idx === 0 ? "true" : "false"}
            class:list={[idx === 0 && "active"]}
            data-slide-index={idx}
          />
        ))
      }
    </div>
  </div>
</section>

<style>
  /* ── CSS-only Carousel using scroll-snap + ::scroll-marker ── */

  .carousel {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: 100%;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    scrollbar-width: none;
    -webkit-overflow-scrolling: touch;
    scroll-marker-group: after;
  }

  .carousel::-webkit-scrollbar {
    display: none;
  }

  .carousel__slide {
    scroll-snap-align: start;
    scroll-snap-stop: always;
  }

  /* ── Slide layout: 1:1 columns ── */
  .carousel-layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    align-items: start;
  }

  @media (min-width: 768px) {
    .carousel-layout {
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
    }
  }

  .carousel-text {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    order: 2;
  }

  .carousel-image {
    order: 1;
  }

  @media (min-width: 768px) {
    .carousel-text {
      order: 1;
    }
    .carousel-image {
      order: 2;
    }
  }

  /* ── Scroll marker group — line indicators ── */
  .carousel::scroll-marker-group {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    padding-block-start: 2.5rem;
  }

  .carousel__slide::scroll-marker {
    content: "";
    inline-size: 1.5rem;
    block-size: 3px;
    background-color: var(--color-viking-gold);
    opacity: 0.3;
    transform: scaleX(1);
    transition: opacity 0.3s ease, transform 0.3s ease;
    cursor: pointer;
  }

  .carousel__slide::scroll-marker:hover {
    opacity: 0.6;
  }

  .carousel__slide::scroll-marker:target-current {
    opacity: 1;
    transform: scaleX(1.5);
  }
  /* ── JS fallback marker group (default visible) ── */
  .carousel-markers {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.75rem;
    padding-block-start: 2.5rem;
  }

  .carousel-markers button {
    appearance: none;
    display: block;
    inline-size: 1.5rem;
    block-size: 3px;
    background-color: var(--color-viking-gold);
    opacity: 0.3;
    transform: scaleX(1);
    transition: opacity 0.3s ease, transform 0.3s ease;
    cursor: pointer;
    border: none;
    border-radius: 0;
    padding: 0;
    margin: 0;
    outline: none;
    /* Expand touch target without changing visual size */
    position: relative;
  }

  .carousel-markers button::before {
    content: "";
    position: absolute;
    inset: -12px -4px;
  }

  .carousel-markers button:hover {
    opacity: 0.6;
  }

  .carousel-markers button:focus-visible {
    opacity: 0.6;
  }

  .carousel-markers button.active {
    opacity: 1;
    transform: scaleX(1.5);
  }

  .carousel.carousel--native-markers + .carousel-markers {
    display: none;
  }
</style>

<script>
  (() => {
    const supports = (condition: string) => {
      try {
        return CSS.supports(condition);
      } catch {
        return false;
      }
    };

    // Some browsers parse parts of the feature but do not render native markers.
    const hasNativeScrollMarkers =
      CSS.supports('scroll-marker-group', 'after') &&
      supports('selector(::scroll-marker-group)') &&
      supports('selector(::scroll-marker)');

    const carousel = document.querySelector('.carousel') as HTMLElement | null;
    const markersContainer = document.querySelector('.carousel-markers') as HTMLElement | null;
    if (!carousel || !markersContainer) {
      return;
    }

    if (hasNativeScrollMarkers) {
      carousel.classList.add('carousel--native-markers');
      return;
    }

    const slides = carousel.querySelectorAll('.carousel__slide');
    const buttons = markersContainer.querySelectorAll('button');

    // Click → scroll to slide
    buttons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const idx = Number(btn.dataset.slideIndex);
        (slides[idx] as HTMLElement).scrollIntoView({
          behavior: 'smooth',
          block: 'nearest',
          inline: 'start',
        });
      });
    });

    // Scroll → update active marker
    const observer = new IntersectionObserver(
      (entries) => {
        for (const entry of entries) {
          if (entry.isIntersecting) {
            const idx = Array.from(slides).indexOf(entry.target);
            buttons.forEach((btn, i) => {
              const isActive = i === idx;
              btn.classList.toggle('active', isActive);
              btn.setAttribute('aria-selected', String(isActive));
            });
          }
        }
      },
      { root: carousel, threshold: 0.5 },
    );

    slides.forEach((slide) => observer.observe(slide));
  })();
</script>
