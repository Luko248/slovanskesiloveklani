---
const slides = [
  {
    title: "Historický slovanský boj",
    description:
      "Hlavní bod doprovodného programu — ukázka historického slovanského boje. Uvidíte souboje s meči a štíty, sekerami i halapartnami v podání zkušených šermířů. Prožijte atmosféru dávných bitev na vlastní oči.",
    image: "/images/program/duel.avif",
  },
  {
    title: "Tradiční kovářská dílna",
    description:
      "Na místě bude přítomen tradiční kovář s ukázkou řemesla našich předků. Sledujte, jak pod údery kladiva vznikají jedinečné výrobky. Zakupte si originální kovaný suvenýr přímo z výhně — nože, přívěsky nebo ozdoby.",
    image: "/images/program/blcksmith.avif",
  },
  {
    title: "Lukostřelba",
    description:
      "Vyzkoušejte si střelbu z luku pod dohledem zkušených instruktorů. Ať už jste začátečník nebo ostřílený lučištník, na místě si můžete otestovat svůj postřeh a přesnost. Zábava pro děti i dospělé.",
    image: "/images/program/bow-shooting.avif",
  },
  {
    title: "Občerstvení & Grill",
    description:
      "Naši dobrovolní hasiči pro vás připraví grilované speciality — klobásy, steaky a další pochoutky přímo na ohni. K dispozici bude také bar s točeným pivem, medovinou a nealkoholickými nápoji. Nikdo neodejde hladový.",
    image: "/images/program/refreshment.avif",
  },
];
const total = slides.length.toString().padStart(2, "0");
---

<section
  id="attractions"
  class="py-16 md:py-32 bg-deep-charcoal relative scroll-mt-24"
>
  <div class="container mx-auto px-4 relative z-10">
    <!-- Section Header -->
    <div class="text-center mb-16 max-w-3xl mx-auto">
      <div class="inline-flex items-center gap-4 mb-6">
        <span class="h-1 w-12 bg-viking-green"></span>
        <h2
          class="text-4xl md:text-5xl font-display font-bold text-light-cream"
        >
          Doprovodný Program
        </h2>
        <span class="h-1 w-12 bg-viking-green"></span>
      </div>
      <p class="text-xl text-gray-400">
        Slovanské Silové Klání není jen soutěž — je to celý den plný zážitků,
        řemesel a chutí.
      </p>
    </div>

    <!-- CSS-only Carousel — scroll-snap + ::scroll-marker -->
    <div class="carousel max-w-4xl mx-auto">
      {
        slides.map((slide, idx) => (
          <div class="carousel__slide">
            <div class="carousel-layout">
              {/* Text side */}
              <div class="carousel-text">
                <div class="inline-flex items-center gap-3">
                  <span class="h-1 w-8 bg-viking-gold" />
                  <span class="text-viking-gold font-display text-sm uppercase tracking-widest">
                    {`0${idx + 1} / ${total}`}
                  </span>
                </div>
                <h3 class="text-3xl md:text-4xl font-display font-bold text-light-cream">
                  {slide.title}
                </h3>
                <p class="text-lg leading-relaxed text-gray-400">
                  {slide.description}
                </p>
              </div>

              {/* Image side */}
              <div class="carousel-image">
                <div class={`relative category-card overflow-hidden aspect-[4/3] border-8 border-double ${idx % 2 === 0 ? 'border-viking-green/40' : 'border-viking-gold/40'}`}>
                  <img
                    src={slide.image}
                    alt={slide.title}
                    class="w-full h-full object-cover"
                    loading="lazy"
                  />
                  <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent pointer-events-none" />
                </div>
              </div>
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  /* ── CSS-only Carousel using scroll-snap + ::scroll-marker ── */

  .carousel {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: 100%;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    scrollbar-width: none;
    -webkit-overflow-scrolling: touch;
    scroll-marker-group: after;
  }

  .carousel::-webkit-scrollbar {
    display: none;
  }

  .carousel__slide {
    scroll-snap-align: start;
    scroll-snap-stop: always;
  }

  /* ── Slide layout: 1:1 columns ── */
  .carousel-layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    align-items: start;
  }

  @media (min-width: 768px) {
    .carousel-layout {
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
    }
  }

  .carousel-text {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    order: 2;
  }

  .carousel-image {
    order: 1;
  }

  @media (min-width: 768px) {
    .carousel-text {
      order: 1;
    }
    .carousel-image {
      order: 2;
    }
  }

  /* ── Scroll marker group — line indicators ── */
  .carousel::scroll-marker-group {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    padding-block-start: 2.5rem;
  }

  .carousel__slide::scroll-marker {
    content: "";
    inline-size: 1.5rem;
    block-size: 3px;
    background-color: var(--color-viking-gold);
    opacity: 0.3;
    scale: 1;
    transition: opacity 0.3s ease, scale 0.3s ease;
    cursor: pointer;
  }

  .carousel__slide::scroll-marker:hover {
    opacity: 0.6;
  }

  .carousel__slide::scroll-marker:target-current {
    opacity: 1;
    scale: 1.5 1;
  }
  /* ── JS fallback marker group (hidden when native markers work) ── */
  .carousel-markers {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    padding-block-start: 2.5rem;
  }

  .carousel-markers button {
    inline-size: 1.5rem;
    block-size: 3px;
    background-color: var(--color-viking-gold);
    opacity: 0.3;
    scale: 1;
    transition: opacity 0.3s ease, scale 0.3s ease;
    cursor: pointer;
    border: none;
    padding: 0;
  }

  .carousel-markers button:hover {
    opacity: 0.6;
  }

  .carousel-markers button.active {
    opacity: 1;
    scale: 1.5 1;
  }

  @supports (scroll-marker-group: after) {
    .carousel-markers {
      display: none;
    }
  }
</style>

<script>
  // Fallback for browsers without scroll-marker-group support (Safari, Firefox)
  if (!CSS.supports('scroll-marker-group', 'after')) {
    const carousel = document.querySelector('.carousel') as HTMLElement | null;
    if (!carousel) throw new Error('Carousel not found');

    const slides = carousel.querySelectorAll('.carousel__slide');
    if (slides.length < 2) throw new Error('Not enough slides');

    // Create marker container
    const markers = document.createElement('div');
    markers.className = 'carousel-markers';
    markers.setAttribute('role', 'tablist');
    markers.setAttribute('aria-label', 'Carousel navigation');

    slides.forEach((_, i) => {
      const btn = document.createElement('button');
      btn.setAttribute('role', 'tab');
      btn.setAttribute('aria-label', `Slide ${i + 1}`);
      if (i === 0) btn.classList.add('active');
      btn.addEventListener('click', () => {
        (slides[i] as HTMLElement).scrollIntoView({
          behavior: 'smooth',
          block: 'nearest',
          inline: 'start',
        });
      });
      markers.appendChild(btn);
    });

    carousel.parentElement?.appendChild(markers);

    // Update active marker on scroll
    const observer = new IntersectionObserver(
      (entries) => {
        for (const entry of entries) {
          if (entry.isIntersecting) {
            const idx = Array.from(slides).indexOf(entry.target);
            markers.querySelectorAll('button').forEach((btn, i) => {
              btn.classList.toggle('active', i === idx);
            });
          }
        }
      },
      { root: carousel, threshold: 0.5 },
    );

    slides.forEach((slide) => observer.observe(slide));
  }
</script>
